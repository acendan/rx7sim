import{V as v,B as Re,L as je,a as Ue,R as $e,b as oe,S as Ee,G as Ae,C as qe,M as de,D as Xe,c as ie,Q as Be,d as Le,e as Ke,f as G,g as be,P as Qe,A as Ye,h as Ze,i as Je,j as et,k as tt,l as Oe,F as nt,m as ot,n as it,o as xe,p as st,H as at,q as rt,r as lt,W as ct,s as dt,t as ut,E as ft,u as ke,v as gt,w as ht,x as pt,O as mt,y as yt,z as bt,I as xt,J as ee,K as wt}from"./vendor-tWInzr5k.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const I={STOP:"stop",DRIVE:"drive",ACCEL:"accel",DECEL:"decel"},U={MIX:"mix",INTAKE:"intake",EXHAUST:"exhaust",INTERIOR:"interior"},F={MIX:10507946,INTAKE:5152511,EXHAUST:10289023,INTERIOR:16771220},ue={MIX:.8,INTAKE:.5,EXHAUST:.8,INTERIOR:.3},R={innerAngle:45,outerAngle:120,outerGain:.3},C={ambient:{color:16777215,intensity:.5},hemisphere:{skyColor:16777215,groundColor:9276813,intensity:.4},directional:[{color:16711661,intensity:1},{color:16775154,intensity:1},{color:16318207,intensity:.2}]};function vt({color:e=16777215,intensity:o=1,mapSize:n=1024,far:t=15,bounds:i={left:-7,right:7,top:7,bottom:-7},position:a=[5,3,4]}={}){const s=new Ke(e,o);return s.castShadow=!0,s.shadow.mapSize.set(n,n),s.shadow.camera.far=t,s.shadow.camera.left=i.left,s.shadow.camera.right=i.right,s.shadow.camera.top=i.top,s.shadow.camera.bottom=i.bottom,s.position.set(...a),s}function _t(e=[]){return e.map(o=>vt(o))}function $(e){if(typeof e=="string"){if(e.startsWith("#")&&(e.length===7||e.length===9))return e.slice(0,7);try{const o=Number(e);if(!Number.isNaN(o))return`#${(o>>>0).toString(16).padStart(6,"0")}`}catch{}return e}return`#${(e>>>0).toString(16).padStart(6,"0")}`}function Et(e,{size:o=.2,color:n=16776960,showCone:t=!1,coneAngle:i=R.innerAngle,coneDirection:a=new v(0,0,1)}={}){const s=new Ae;if(t){const c=o*3,f=G.degToRad(i),l=Math.tan(f)*c,p=new qe(l,c,16,1,!0),d=new de({color:n,wireframe:!0,transparent:!0,opacity:.6,side:Xe}),g=new ie(p,d),m=new v(0,-1,0),u=new Be;u.setFromUnitVectors(m,a.clone().normalize()),g.quaternion.copy(u),g.position.copy(a.clone().normalize().multiplyScalar(c/2)),s.add(g);const E=new Le(o*.3),O=new de({color:n,transparent:!0,opacity:.9}),T=new ie(E,O);s.add(T)}else{const c=new Le(o),f=new de({color:n,wireframe:!0,transparent:!0,opacity:.8}),l=new ie(c,f);s.add(l)}return s.position.copy(e.position),s}function Lt({color:e=16777182,intensity:o=3,distance:n=10,angle:t=Math.PI/6,penumbra:i=.5,decay:a=1,leftPosition:s=[.75,.76,1.8],rightPosition:c=[-.75,.76,1.8],targetPosition:f=[0,0,10]}={}){const l=new Ee(e,o,n,t,i,a);l.position.set(...s),l.target.position.set(...f),l.castShadow=!0,l.shadow.mapSize.width=1024,l.shadow.mapSize.height=1024,l.shadow.camera.near=.5,l.shadow.camera.far=20,l.shadow.camera.fov=30;const p=new Ee(e,o,n,t,i,a);return p.position.set(...c),p.target.position.set(...f),p.castShadow=!0,p.shadow.mapSize.width=1024,p.shadow.mapSize.height=1024,p.shadow.camera.near=.5,p.shadow.camera.far=20,p.shadow.camera.fov=30,{left:l,right:p}}function fe(e,o,n,{store:t=null,storeKey:i=null,loop:a=!1,refDistance:s=20,volume:c=null,offset:f=0,onEnded:l=null}={}){const p=d=>{try{o.stop(),o.setBuffer(d),o.setRefDistance(s),o.setLoop(a),typeof c=="number"&&o.setVolume&&o.setVolume(c),l&&(o.onEnded=l),o.play()}catch{}};if(t&&i&&t[i]){p(t[i]);return}e.load(n,d=>{console.log(`Loaded Audio - ${pos}: ${key}`),t&&i&&(t[i]=d),p(d)})}function ge({screenAnchor:e=new oe(-.9,.9),targetLocalPos:o=new v(0,0,0),targetObject:n=null,label:t="btn",color:i=65280}={}){const a=[new v,new v],s=new Re().setFromPoints(a),c=new je({color:i}),f=new Ue(s,c);f.set;let l=null;typeof document<"u"&&(l=document.createElement("button"),l.color=i,l.dimmed=!1,l.className="three-linebutton",l.style.position="absolute",l.style.padding="4px 12px",l.style.border="none",l.style.borderRadius="12px",l.style.backgroundColor=$(i),l.style.color="#272727ff",l.style.fontFamily="sans-serif",l.style.fontSize="14px",l.style.cursor="pointer",l.style.transform="translate(-50%, -50%)",l.style.boxShadow="0 2px 2px rgba(255, 255, 255, 0.24)",l.style.userSelect="none",l.textContent=t,document.body.appendChild(l),l.addEventListener("mouseenter",()=>{l.style.backgroundColor=$(Math.min(i*4,16777215))}),l.addEventListener("mouseleave",()=>{l.style.backgroundColor=l.dimmed?"#444444":$(i)}));const p=new $e;let d=!0;function g(u){const E=new v(e.x,e.y,.5);E.unproject(u);const O=E.clone().sub(u.position).normalize(),T=u.position.clone().add(O.clone().multiplyScalar(1));let V=new v;n?(V.copy(o),n.localToWorld(V)):V.copy(o);const ze=V.clone().sub(u.position).normalize();p.set(u.position,ze);let z=V.clone();if(n){const L=p.intersectObject(n,!0);L&&L.length>0?z.copy(L[0].point):z.copy(V)}const ce=f.geometry.attributes.position;if(ce.setXYZ(0,T.x,T.y,T.z),ce.setXYZ(1,z.x,z.y,z.z),ce.needsUpdate=!0,l){const L=T.clone().project(u);if(!d||L.z>1||L.z<-1||L.x<-1.2||L.x>1.2||L.y<-1.2||L.y>1.2)l.style.display="none";else{l.style.display="";const _e=document.querySelector("canvas.webgl");if(_e){const J=_e.getBoundingClientRect(),Ge=(L.x*.5+.5)*J.width+J.left,We=(-L.y*.5+.5)*J.height+J.top;l.style.left=`${Ge}px`,l.style.top=`${We}px`}}}}function m(u){d=u,f.visible=u,l&&(l.style.display=u?"":"none")}return{line:f,button:l,update:g,setVisible:m}}const te=[],H=new Re,se=new Float32Array(1e3*3),W=new Float32Array(1e3*4),Ie=new Float32Array(1e3);H.setAttribute("position",new be(se,3));H.setAttribute("color",new be(W,4));H.setAttribute("size",new be(Ie,1));const Ct=new Qe({size:.1,vertexColors:!0,transparent:!0,opacity:.5,blending:Ye}),St=new Ze(H,Ct),K={emitters:[],initialize:()=>{const e={enabled:!1,position:new v(-.5,.3,-2),settings:{radius_1:.02,radius_2:.1,radius_height:.2,add_time:.02,elapsed:0,live_time_from:1,live_time_to:1.5,opacity_decrease:.008,rotation_from:.5,rotation_to:1,speed_from:.003,speed_to:.006,scale_from:.1,scale_increase:.002,color_from:[.9,.9,.9],color_to:[.5,.5,.5],color_speed_from:1,color_speed_to:1,brightness_from:.5,brightness_to:.9,opacity:.6,blend:.8,texture:.5}};K.emitters.push(e)},update:(e,o)=>{K.emitters.forEach(n=>{if(o!=="stop"?(n.enabled=!0,n.settings.add_time=o==="accel"?.01:.02,n.settings.speed_from=o==="accel"?.005:.003,n.settings.speed_to=o==="accel"?.008:.006):n.enabled=!1,n.enabled){let t=0;for(n.settings.elapsed+=e,t=Math.floor(n.settings.elapsed/n.settings.add_time),n.settings.elapsed-=t*n.settings.add_time;t--;){const i=n.settings.radius_1*Math.sqrt(Math.random()),a=2*Math.PI*Math.random(),s=n.position.x+i*Math.cos(a),c=n.position.z+i*Math.sin(a),f=n.settings.radius_2*Math.sqrt(Math.random()),l=s+f*Math.cos(a),p=c+f*Math.sin(a),d=new v(l-s,n.settings.radius_height,p-c).normalize(),g=Math.random()*(n.settings.speed_to-n.settings.speed_from)+n.settings.speed_from;d.multiplyScalar(g);const m=Math.random()*(n.settings.brightness_to-n.settings.brightness_from)+n.settings.brightness_from;te.push({offset:[s,n.position.y,c],scale:[n.settings.scale_from,n.settings.scale_from],quaternion:[d.x,d.y,d.z,3],rotation:Math.random()*(n.settings.rotation_to-n.settings.rotation_from)+n.settings.rotation_from,color:[1,1,1,n.settings.opacity],blend:n.settings.blend,texture:n.settings.texture,live:Math.random()*(n.settings.live_time_to-n.settings.live_time_from)+n.settings.live_time_from,scale_increase:n.settings.scale_increase,opacity_decrease:n.settings.opacity_decrease,color_from:n.settings.color_from.map(u=>u*m),color_to:n.settings.color_to.map(u=>u*m),color_speed:Math.random()*(n.settings.color_speed_to-n.settings.color_speed_from)+n.settings.color_speed_from,color_pr:0})}}});for(let n=te.length-1;n>=0;n--){const t=te[n];if(t.offset[0]+=t.quaternion[0],t.offset[1]+=t.quaternion[1],t.offset[2]+=t.quaternion[2],t.scale[0]+=t.scale_increase,t.scale[1]+=t.scale_increase,t.color_pr+=t.color_speed,t.color_pr>1&&(t.color_pr=1),t.color[0]=t.color_from[0]+(t.color_to[0]-t.color_from[0])*t.color_pr,t.color[1]=t.color_from[1]+(t.color_to[1]-t.color_from[1])*t.color_pr,t.color[2]=t.color_from[2]+(t.color_to[2]-t.color_from[2])*t.color_pr,t.color[3]-=t.opacity_decrease,t.live-=e,t.live<=0||t.color[3]<=0){te.splice(n,1);continue}const i=n*3;se[i]=t.offset[0],se[i+1]=t.offset[1],se[i+2]=t.offset[2];const a=n*4;W[a]=t.color[0],W[a+1]=t.color[1],W[a+2]=t.color[2],W[a+3]=t.color[3],Ie[n]=t.scale[0]}H.attributes.position.needsUpdate=!0,H.attributes.color.needsUpdate=!0,H.attributes.size.needsUpdate=!0},getMesh:()=>St};function Mt({emitters:e={},initialVisible:o=!1}={}){let n=o,t=null;const i=new Map;function a(){return t||(t=document.createElement("div"),t.id="audio-volume-panel",Object.assign(t.style,{position:"fixed",bottom:"10px",right:"10px",padding:"8px",background:"rgba(0,0,0,0.6)",color:"#fff",borderRadius:"6px",zIndex:9999,fontFamily:"monospace",fontSize:"12px",pointerEvents:"none",display:n?"":"none"}),document.body.appendChild(t),t)}function s(d){const g=document.createElement("div");g.dataset.pos=d,Object.assign(g.style,{display:"flex",alignItems:"center",marginBottom:"6px",pointerEvents:"auto",flexDirection:"row"});const m=document.createElement("div");m.className="vol-label",m.textContent=d,Object.assign(m.style,{width:"70px",textTransform:"capitalize"});const u=document.createElement("div");u.className="vol-bar-container",Object.assign(u.style,{width:"64px",height:"12px",background:"rgba(255,255,255,0.08)",borderRadius:"3px",display:"flex",alignItems:"center",overflow:"hidden",marginLeft:"8px",marginRight:"8px"});const E=document.createElement("div");E.className="vol-bar",Object.assign(E.style,{width:"0%",height:"100%",background:"#666",transition:"width 0.08s linear"});const O=d.toUpperCase();return F[O]!==void 0&&(E.style.background=$(F[O])),u.appendChild(E),g.appendChild(m),g.appendChild(u),g}function c(d,g){if(!i.has(d)&&g?.getOutput()){const m=new Je(g,32);i.set(d,m)}return i.get(d)}function f(d,g){const m=c(d,g);if(!m)return 0;const u=m.getAverageFrequency()/255,E=g&&g.getVolume?g.getVolume():0;return u*E}function l(){const d=a();Object.entries(e).forEach(([g,m])=>{if(g==="mix")return;let u=d.querySelector(`[data-pos="${g}"]`);u||(u=s(g),d.appendChild(u));const E=f(g,m)*3,O=u.querySelector(".vol-bar");O.style.width=`${Math.max(0,Math.min(1,E))*100}%`}),t.style.display=n?"":"none"}function p(d){n=!!d,t&&(t.style.display=n?"":"none")}return{update:l,setVisible:p,isVisible:()=>n}}et.enabled=!1;var D=I.STOP,ae=U.MIX;const Fe=document.querySelector("canvas.webgl"),h=new tt;h.background=new Oe(10526880);h.fog=new nt(15716789,.05);const He=new ot,q={Meters:!0,Emitters:!1},le=He.addFolder("Audio");let j=null;const Y=He.addFolder("Vehicle");let pe=null,me=null;const we=new it,ne=new xe,Rt=new st;new at;const Q=new ie(new rt(10,10),new lt({color:"#444444",metalness:0,roughness:.5}));Q.receiveShadow=!0;Q.rotation.x=-Math.PI*.5;h.add(Q);const Te={Garage:{path:"./hdri/garage.hdr",reverb:"Garage",lighting:{ambient:{color:15790320,intensity:.2},hemisphere:{skyColor:12632256,groundColor:3815994,intensity:.15},directional:[{color:12375295,intensity:1.5},{color:16768426,intensity:.5},{color:8947848,intensity:.1}]}},Track:{path:"./hdri/track.hdr",reverb:"Outdoors",lighting:{ambient:{color:16774803,intensity:.25},hemisphere:{skyColor:13428479,groundColor:5921370,intensity:.15},directional:[{color:16777215,intensity:.1},{color:16773841,intensity:.1},{color:11193599,intensity:0}]}}},he=h.background?h.background.clone():new Oe(10526880);let P=null;const At=["None",...Object.keys(Te)],Ot={HDR:"None"};Y.add(Ot,"HDR",At).name("Level Select").onChange(e=>{if(e==="None"){if(P){try{P.dispose()}catch{}P=null}h.background=he.clone?he.clone():he,h.environment=null,Q.visible=!0,Ce(null),h.fog&&(h.fog.color.set(15716789),h.fog.density=.05),typeof y.toneMappingExposure=="number"&&(y.toneMappingExposure=b.exposure),h.traverse(i=>{i.isMesh&&i.material&&(Array.isArray(i.material)?i.material.forEach(a=>a.needsUpdate=!0):i.material.needsUpdate=!0)}),console.log("[HDR Reset] Ambient",A.intensity,A.color.getHexString()),Z.forEach((i,a)=>console.log(`[HDR Reset] Dir${a}`,i.intensity,i.color.getHexString())),console.log("[HDR Reset] Hemi",_.intensity,_.color.getHexString(),_.groundColor.getHexString()),w.removeConvolutionReverb(),re.Reverb="None",j&&j.updateDisplay();return}const o=Te[e];if(!o)return;const n=typeof o=="string"?o:o.path,t=typeof o=="object"?o.reverb:null;Rt.load(n,i=>{if(P)try{P.dispose()}catch{}if(i.mapping=ft,P=i,h.background=i,h.environment=i,Q.visible=!1,o.lighting&&Ce(o.lighting),t&&re&&(re.Reverb=t,j)){j.updateDisplay();const a=ye[t];if(a){const{path:s,blend:c=.5,scalingFactor:f=1}=a;w.currentReverbBlend=c,w.currentReverbScalingFactor=f,new xe().load(s,p=>{w.applyConvolutionReverb(p)})}}})});let x=new Ae;h.add(x);x.add(K.getMesh());const X=[];let r={mixerWheels:null,actWheelsRot:null,actTiresRot:null,mixerLights:null,actLights0:null,actLights1:null,actLights2:null,actLights3:null,actLights4:null,headLightL:null,headLightR:null,lightsFlipFlop:!0,lightsIntensity:3,lightsTimeScaleToggle:()=>{if(r.lightsFlipFlop){r.mixerLights.timeScale=1.5;for(let e=0;e<5;e++){const o=`actLights${e}`;r[o].time=0}r.lightsFlipFlop=!1}else{r.mixerLights.timeScale=-1.5;for(let e=0;e<5;e++){const o=`actLights${e}`;r[o].time=r[o].getClip().duration-r[o].time}r.lightsFlipFlop=!0}},lights:()=>{r.mixerLights.stopAllAction(),r.lightsTimeScaleToggle(),r.actLights0.play(),r.actLights1.play(),r.actLights2.play(),r.actLights3.play(),r.actLights4.play()}};we.load("./model/rx7/rx7.gltf",e=>{console.log("Loaded Model - RX7",e),e.scene.scale.set(1,1,1),x.add(e.scene),K.initialize();let o,n,t;o=ge({screenAnchor:new oe(-.5,-.8),targetLocalPos:new v(0,.2,2.1),targetObject:e.scene,label:"Intake",color:F.INTAKE}),n=ge({screenAnchor:new oe(.5,-.8),targetLocalPos:new v(-.5,.3,-2),targetObject:e.scene,label:"Exhaust",color:F.EXHAUST}),t=ge({screenAnchor:new oe(0,-.8),targetLocalPos:new v(0,.1,-.2),targetObject:e.scene,label:"Interior",color:F.INTERIOR}),[o,n,t].forEach(a=>{h.add(a.line),X.push(a),a.button.addEventListener("click",()=>{U[a.button.textContent.toUpperCase()]===ae?(ae=U.MIX,X.forEach(s=>{s!==a&&(s.button.style.backgroundColor=$(F[s.button.textContent.toUpperCase()]),s.button.style.color="#272727ff",s.line.visible=!0,s.button.dimmed=!1)}),q.Emitters&&B.forEach(s=>s.visible=!0)):(ae=U[a.button.textContent.toUpperCase()],X.forEach(s=>{if(s!==a){if(s.button.style.backgroundColor="#444444",s.button.style.color="#888888",s.line.visible=!1,s.button.dimmed=!0,q.Emitters){const c=s.button.textContent.toLowerCase(),f=B.get(c);f&&(f.visible=!1)}}else if(s.button.style.color="#272727ff",s.line.visible=!0,s.button.dimmed=!1,q.Emitters){const c=s.button.textContent.toLowerCase(),f=B.get(c);f&&(f.visible=!0)}}))})});const i={"Solo Buttons":!0};le.add(i,"Solo Buttons").onChange(a=>{o.setVisible(a),n.setVisible(a),t.setVisible(a)})});we.load("./model/rx7_wheels/rx7_wheels.gltf",e=>{console.log("Loaded Model - Wheel",e),e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0),x.add(e.scene);const o=e.scene.clone();o.position.set(0,0,2.45),x.add(o);const n=e.scene.clone();n.position.set(0,0,2.45),n.scale.set(-1,1,1),x.add(n);const t=e.scene.clone();t.position.set(0,0,0),t.scale.set(-1,1,1),x.add(t),r.mixerWheels=new ke(new gt(e.scene,o,n,t)),r.actWheelsRot=r.mixerWheels.clipAction(e.animations[0]),r.actTiresRot=r.mixerWheels.clipAction(e.animations[1])});we.load("./model/rx7_lights/rx7_lights.gltf",e=>{console.log("Loaded Model - Headlights",e),e.scene.scale.set(1,1,1),x.add(e.scene),r.mixerLights=new ke(e.scene);for(let t=0;t<5;t++){const i=`actLights${t}`;r[i]=r.mixerLights.clipAction(e.animations[t]),r[i].setLoop(ht),r[i].clampWhenFinished=!0}const{left:o,right:n}=Lt({intensity:r.lightsIntensity});r.headLightL=o,r.headLightR=n,x.add(r.headLightL),x.add(r.headLightL.target),x.add(r.headLightR),x.add(r.headLightR.target),Y.add(r,"lights").name("Headlights")});const _=new ut(C.hemisphere.skyColor,C.hemisphere.groundColor,C.hemisphere.intensity);_.position.set(0,100,0);h.add(_);const A=new dt(C.ambient.color,C.ambient.intensity);h.add(A);const Z=_t([{color:C.directional[0].color,intensity:C.directional[0].intensity,position:[5,3,4]},{color:C.directional[1].color,intensity:C.directional[1].intensity,position:[8,3,-1]},{color:C.directional[2].color,intensity:C.directional[2].intensity,position:[-5,5,-5]}]);Z.forEach(e=>h.add(e));let b=null;function Ve(){b={ambient:{color:A.color.getHex(),intensity:A.intensity},hemi:{sky:_.color.getHex(),ground:_.groundColor.getHex(),intensity:_.intensity},directional:Z.map(e=>({color:e.color.getHex(),intensity:e.intensity})),fog:h.fog?{color:h.fog.color.getHex(),density:h.fog.density}:null,exposure:typeof y<"u"&&typeof y.toneMappingExposure=="number"?y.toneMappingExposure:1}}function Pe(){b||Ve(),A.color.setHex(b.ambient.color),A.intensity=b.ambient.intensity,_.color.setHex(b.hemi.sky),_.groundColor.setHex(b.hemi.ground),_.intensity=b.hemi.intensity,Z.forEach((e,o)=>{e.color.setHex(b.directional[o].color),e.intensity=b.directional[o].intensity}),h.fog&&b.fog&&(h.fog.color.setHex(b.fog.color),h.fog.density=b.fog.density),b&&typeof y<"u"&&typeof y.toneMappingExposure=="number"&&(y.toneMappingExposure=b.exposure)}function Ce(e){if(!e){Pe();return}e.ambient&&(e.ambient.color!==void 0&&A.color.setHex(e.ambient.color),e.ambient.intensity!==void 0&&(A.intensity=e.ambient.intensity)),e.hemisphere&&(e.hemisphere.skyColor!==void 0&&_.color.setHex(e.hemisphere.skyColor),e.hemisphere.groundColor!==void 0&&_.groundColor.setHex(e.hemisphere.groundColor),e.hemisphere.intensity!==void 0&&(_.intensity=e.hemisphere.intensity)),e.directional&&Array.isArray(e.directional)&&Z.forEach((o,n)=>{const t=e.directional[n];t&&(t.color!==void 0&&o.color.setHex(t.color),t.intensity!==void 0&&(o.intensity=t.intensity))})}const S={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",()=>{S.width=window.innerWidth,S.height=window.innerHeight,k.aspect=S.width/S.height,k.updateProjectionMatrix(),y.setSize(S.width,S.height),y.setPixelRatio(Math.min(window.devicePixelRatio,2))});const k=new pt(75,S.width/S.height,.1,100);k.position.set(4,2,3);h.add(k);const ve=new mt(k,Fe);ve.target.set(0,.75,0);ve.enableDamping=!0;const y=new ct({canvas:Fe});y.outputColorSpace=yt;y.shadowMap.enabled=!0;y.shadowMap.type=bt;y.setSize(S.width,S.height);y.setPixelRatio(Math.min(window.devicePixelRatio,2));Ve();Pe();const N=new xt;k.add(N);const M={mix:new ee(N),intake:new ee(N),exhaust:new ee(N),interior:new ee(N)};console.log("Audio Emitters:",M);Object.entries(M).forEach(([e,o])=>{switch(x.add(o),e){case"intake":o.position.set(0,.2,2.1),o.setVolume(0),o.setDirectionalCone(G.degToRad(R.innerAngle),G.degToRad(R.outerAngle),R.outerGain);break;case"exhaust":o.position.set(-.5,.3,-2),o.setVolume(0),o.rotation.y=Math.PI,o.setDirectionalCone(G.degToRad(R.innerAngle),G.degToRad(R.outerAngle),R.outerGain);break;case"interior":o.position.set(0,.5,-.2),o.setVolume(0);break;case"mix":o.position.set(0,0,0),o.setVolume(1);break;default:o.position.set(0,0,0);break}});const w={buffers:{mix:{},intake:{ignitionOn:null,idle:null,ignitionOff:null},exhaust:{ignitionOn:null,idle:null,ignitionOff:null},interior:{ignitionOn:null,idle:null,ignitionOff:null}},currentEmitter:null,setEmitterVolumes(e){["intake","exhaust","interior"].forEach(n=>{const t=M[n];if(!t)return;const i=e===U.MIX?ue.MIX:n===e?1:0,a=ue[n.toUpperCase()]!==void 0?ue[n.toUpperCase()]:1,s=Math.max(0,Math.min(1,i*a)),c=t.getVolume();c<s?t.setVolume(Math.min(s,c+.2)):c>s&&t.setVolume(Math.max(s,c-.2))}),M.mix.setVolume(0)},ignitionOn:()=>{Object.entries(M).forEach(([e,o])=>{e!=="mix"&&fe(ne,o,`./audio/${e}/ignitionOn.ogg`,{store:w.buffers[e],storeKey:"ignitionOn",loop:!1,onEnded:()=>{fe(ne,o,`./audio/${e}/idle.ogg`,{store:w.buffers[e],storeKey:"idle",loop:!0,onEnded:()=>{}})}})}),D=I.ACCEL,r.mixerWheels.stopAllAction(),r.actWheelsRot.play(),r.actTiresRot.play(),r.mixerWheels.timeScale=.01,pe.hide(),me.show()},ignitionOff:()=>{Object.entries(M).forEach(([e,o])=>{e!=="mix"&&fe(ne,o,`./audio/${e}/ignitionOff.ogg`,{store:w.buffers[e],storeKey:"ignitionOff",loop:!1,onEnded:()=>{o.stop()}})}),D=I.DECEL,pe.show(),me.hide()},load(){const e=this;Object.keys(e.buffers).forEach(o=>{Object.keys(e.buffers[o]).forEach(n=>{ne.load(`./audio/${o}/${n}.ogg`,t=>{e.buffers[o][n]=t}),console.log(`Loaded Audio - ${o}: ${n}`)})})},applyConvolutionReverb(e){const o=this.currentReverbBlend??.5;Object.values(M).forEach(n=>{if(n._reverbNodes){try{const{dryGain:f,wetGain:l,convolver:p}=n._reverbNodes;f.disconnect(),l.disconnect(),p.disconnect()}catch{}n._reverbNodes=null}const t=N.context,i=t.createConvolver();i.buffer=e;const a=t.createGain(),s=t.createGain();a.gain.value=o*this.currentReverbScalingFactor,s.gain.value=(1-o)*this.currentReverbScalingFactor;const c=n.panner;if(!c){console.warn("PositionalAudio panner node missing; cannot apply reverb graph");return}c.connect(s),s.connect(t.destination),c.connect(i),i.connect(a),a.connect(t.destination),n._reverbNodes={convolver:i,wetGain:a,dryGain:s}})},removeConvolutionReverb(){Object.values(M).forEach(e=>{if(e._reverbNodes){try{const{dryGain:o,wetGain:n,convolver:t}=e._reverbNodes;o.disconnect(),n.disconnect(),t.disconnect()}catch{}e._reverbNodes=null}}),this.currentReverbBlend=null,this.currentReverbScalingFactor=null}};w.load();const ye={Garage:{path:"./audio/ir/garage.ogg",blend:.8,scalingFactor:.33},Outdoors:{path:"./audio/ir/outdoors.ogg",blend:.6,scalingFactor:.2}},re={Reverb:"None"};j=le.add(re,"Reverb",["None",...Object.keys(ye)]).name("Conv. Reverb").onChange(e=>{if(e==="None"){w.removeConvolutionReverb();return}const o=ye[e];if(!o)return;const{path:n,blend:t=.5,scalingFactor:i=1}=o;w.currentReverbBlend=t,w.currentReverbScalingFactor=i,new xe().load(n,s=>{w.applyConvolutionReverb(s)})});const De=Mt({emitters:M,initialVisible:!0});le.add(q,"Meters").onChange(e=>De.setVisible(e));const B=new Map;Object.entries(M).forEach(([e,o])=>{if(e==="mix")return;const n={color:F[e.toUpperCase()]||16776960,size:.4};e==="intake"?(n.showCone=!0,n.coneAngle=R.innerAngle,n.coneDirection=new v(0,0,1)):e==="exhaust"&&(n.showCone=!0,n.coneAngle=R.innerAngle,n.coneDirection=new v(0,0,-1));const t=Et(o,n);t.visible=!1,x.add(t),B.set(e,t)});le.add(q,"Emitters").onChange(e=>{B.forEach(o=>o.visible=e)});const Se=["Mazda RX-7 FD"];Y.add({car:Se[0]},"car",Se).name("Car").onChange(e=>{});pe=Y.add(w,"ignitionOn").name("Ignition On");me=Y.add(w,"ignitionOff").name("Ignition Off").hide();const kt=new wt;let Me=0;const Ne=()=>{const e=kt.getElapsedTime(),o=e-Me;if(Me=e,r.mixerWheels)switch(r.mixerWheels.update(o),D){case I.ACCEL:for(;r.mixerWheels.timeScale<1;)r.mixerWheels.timeScale+=o,r.mixerWheels.timeScale>=1&&(r.mixerWheels.timeScale=1,D=I.DRIVE);break;case I.DECEL:for(;r.mixerWheels.timeScale>0;)r.mixerWheels.timeScale-=o,r.mixerWheels.timeScale<=0&&(r.mixerWheels.timeScale=0,D=I.STOP,r.mixerWheels.stopAllAction());break}if(r.mixerLights){r.mixerLights.update(o);const n=r.lightsIntensity-r.actLights0.time/r.actLights0.getClip().duration*r.lightsIntensity;r.headLightL.intensity=r.headLightR.intensity=n}x.position.z=Math.sin(e*2)*.0125,K.update(o,D),ve.update(),X.length>0&&X.forEach(n=>{try{n.update(k)}catch{}}),w.setEmitterVolumes(ae),De.update(),y.render(h,k),window.requestAnimationFrame(Ne)};Ne();
//# sourceMappingURL=index-DK59Gwgb.js.map
