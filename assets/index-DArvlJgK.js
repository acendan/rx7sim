import{G as Be,C as rt,M as ve,D as at,a as de,V as x,Q as lt,S as Ve,b as ct,c as Ne,d as ee,B as Ue,L as dt,e as ut,R as ft,f as ue,g as He,P as pt,A as gt,h as ht,i as mt,j as yt,k as bt,l as Xe,F as xt,m as wt,n as vt,o as We,p as Ct,H as Et,q as Lt,r as St,W as Ft,s as At,t as Rt,E as kt,u as Mt,O as Tt,v as Ot,w as Pt,x as It,y as le,z as $e,I as Ht,J as Wt,K as zt}from"./vendor-D4_FRbEO.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const $={STOP:"stop",DRIVE:"drive",ACCEL:"accel",DECEL:"decel"},ne={MIX:"mix",INTAKE:"intake",EXHAUST:"exhaust",INTERIOR:"interior"},G={MIX:10507946,INTAKE:5152511,EXHAUST:10289023,INTERIOR:16771220},Ce={MIX:.8,INTAKE:.5,EXHAUST:.8,INTERIOR:.3},H={innerAngle:45,outerAngle:120,outerGain:.3},k={ambient:{color:16777215,intensity:.5},hemisphere:{skyColor:16777215,groundColor:9276813,intensity:.4},directional:[{color:16711661,intensity:1},{color:16775154,intensity:1},{color:16318207,intensity:.2}]},Ke={Garage:{path:"./hdri/garage.hdr",reverb:"Garage",lighting:{ambient:{color:15790320,intensity:.2},hemisphere:{skyColor:12632256,groundColor:3815994,intensity:.15},directional:[{color:12375295,intensity:1.5},{color:16768426,intensity:.5},{color:8947848,intensity:.1}]}},Track:{path:"./hdri/track.hdr",reverb:"Outdoors",lighting:{ambient:{color:16774803,intensity:.25},hemisphere:{skyColor:13428479,groundColor:5921370,intensity:.15},directional:[{color:16777215,intensity:.1},{color:16773841,intensity:.1},{color:11193599,intensity:0}]}}};function Dt(){try{const e=document.createElement("canvas"),o=e.getContext("webgl")||e.getContext("experimental-webgl");if(!o)return{available:!1,error:"WebGL is not supported by your browser or graphics driver."};const s=["OES_element_index_uint"];for(const t of s)if(!o.getExtension(t))return{available:!1,error:`WebGL extension ${t} is not supported.`};return{available:!0,error:null}}catch(e){return{available:!1,error:`WebGL check failed: ${e.message}`}}}function Vt(){try{return window.AudioContext||window.webkitAudioContext?{available:!0,error:null}:{available:!1,error:"Web Audio API is not supported by your browser."}}catch(e){return{available:!1,error:`Web Audio API check failed: ${e.message}`}}}function X(e,o,s=!0){const t=document.getElementById("error-overlay");t&&t.remove();const n=document.createElement("div");n.id="error-overlay",Object.assign(n.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:s?"rgba(0, 0, 0, 0.95)":"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"99999",fontFamily:"system-ui, -apple-system, sans-serif",color:"#fff",padding:"20px",boxSizing:"border-box"});const i=document.createElement("div");Object.assign(i.style,{maxWidth:"500px",backgroundColor:"#1a1a1a",borderRadius:"12px",padding:"32px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",border:"1px solid #333"});const r=document.createElement("h2");r.textContent=e,Object.assign(r.style,{margin:"0 0 16px 0",fontSize:"24px",fontWeight:"600",color:"#ff6b6b"});const d=document.createElement("p");if(d.textContent=o,Object.assign(d.style,{margin:"0 0 24px 0",fontSize:"16px",lineHeight:"1.6",color:"#ccc"}),i.appendChild(r),i.appendChild(d),!s){const c=document.createElement("button");c.textContent="Dismiss",Object.assign(c.style,{backgroundColor:"#444",color:"#fff",border:"none",borderRadius:"6px",padding:"12px 24px",fontSize:"14px",cursor:"pointer",fontWeight:"500"}),c.addEventListener("click",()=>n.remove()),c.addEventListener("mouseenter",()=>c.style.backgroundColor="#555"),c.addEventListener("mouseleave",()=>c.style.backgroundColor="#444"),i.appendChild(c)}n.appendChild(i),document.body.appendChild(n)}function Nt(e="Loading..."){const o=document.getElementById("loading-overlay");o&&o.remove();const s=document.createElement("div");s.id="loading-overlay",Object.assign(s.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"99998",fontFamily:"system-ui, -apple-system, sans-serif",color:"#fff"});const t=document.createElement("div");Object.assign(t.style,{textAlign:"center"});const n=document.createElement("div");Object.assign(n.style,{width:"50px",height:"50px",margin:"0 auto 20px",border:"4px solid #333",borderTop:"4px solid #fff",borderRadius:"50%",animation:"spin 1s linear infinite"});const i=document.createElement("div");if(i.textContent=e,Object.assign(i.style,{fontSize:"16px",color:"#ccc"}),!document.getElementById("spinner-style")){const r=document.createElement("style");r.id="spinner-style",r.textContent=`
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `,document.head.appendChild(r)}return t.appendChild(n),t.appendChild(i),s.appendChild(t),document.body.appendChild(s),{update:r=>{i.textContent=r},remove:()=>{s.remove()}}}function Ee(e,o,s=null){return new Promise((t,n)=>{e.load(o,i=>{console.log(`✓ Loaded model: ${o}`),t(i)},s,i=>{console.error(`✗ Failed to load model: ${o}`,i),n(new Error(`Failed to load model ${o}: ${i.message}`))})})}function ye(e,o){return new Promise((s,t)=>{e.load(o,n=>{console.log(`✓ Loaded audio: ${o}`),s(n)},null,n=>{console.error(`✗ Failed to load audio: ${o}`,n),t(new Error(`Failed to load audio ${o}: ${n.message}`))})})}function $t(e,o){return new Promise((s,t)=>{e.load(o,n=>{console.log(`✓ Loaded HDR: ${o}`),s(n)},null,n=>{console.error(`✗ Failed to load HDR: ${o}`,n),t(new Error(`Failed to load HDR ${o}: ${n.message}`))})})}function fe(e){if(e){if(e.children)for(let o=e.children.length-1;o>=0;o--)fe(e.children[o]);e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(o=>Ge(o)):Ge(e.material)),e.renderTarget&&e.renderTarget.dispose(),e.parent&&e.parent.remove(e)}}function Ge(e){e&&(Object.keys(e).forEach(o=>{const s=e[o];s&&typeof s=="object"&&"minFilter"in s&&s.dispose()}),e.dispose())}function Me(e){if(e)try{e.dispose()}catch(o){console.error("Failed to dispose texture:",o)}}function Gt(e){if(e)try{if(e.isPlaying&&e.stop(),e._reverbNodes){const{dryGain:o,wetGain:s,convolver:t}=e._reverbNodes;try{o.disconnect(),s.disconnect(),t.disconnect()}catch(n){console.warn("Error disconnecting reverb nodes:",n)}e._reverbNodes=null}e.disconnect(),e.buffer=null}catch(o){console.error("Failed to dispose audio emitter:",o)}}function _t({color:e=16777215,intensity:o=1,mapSize:s=1024,far:t=15,bounds:n={left:-7,right:7,top:7,bottom:-7},position:i=[5,3,4]}={}){const r=new ct(e,o);return r.castShadow=!0,r.shadow.mapSize.set(s,s),r.shadow.camera.far=t,r.shadow.camera.left=n.left,r.shadow.camera.right=n.right,r.shadow.camera.top=n.top,r.shadow.camera.bottom=n.bottom,r.position.set(...i),r}function qt(e=[]){return e.map(o=>_t(o))}function ie(e){if(typeof e=="string"){if(e.startsWith("#")&&(e.length===7||e.length===9))return e.slice(0,7);try{const o=Number(e);if(!Number.isNaN(o))return`#${(o>>>0).toString(16).padStart(6,"0")}`}catch{}return e}return`#${(e>>>0).toString(16).padStart(6,"0")}`}function jt(e,{size:o=.2,color:s=16776960,showCone:t=!1,coneAngle:n=H.innerAngle,coneDirection:i=new x(0,0,1)}={}){const r=new Be;if(t){const d=o*3,c=ee.degToRad(n),a=Math.tan(c)*d,g=new rt(a,d,16,1,!0),y=new ve({color:s,wireframe:!0,transparent:!0,opacity:.6,side:at}),f=new de(g,y),p=new x(0,-1,0),m=new lt;m.setFromUnitVectors(p,i.clone().normalize()),f.quaternion.copy(m),f.position.copy(i.clone().normalize().multiplyScalar(d/2)),r.add(f);const u=new Ve(o*.3),E=new ve({color:s,transparent:!0,opacity:.9}),b=new de(u,E);r.add(b)}else{const d=new Ve(o),c=new ve({color:s,wireframe:!0,transparent:!0,opacity:.8}),a=new de(d,c);r.add(a)}return r.position.copy(e.position),r}function Bt({color:e=16777182,intensity:o=3,distance:s=10,angle:t=Math.PI/6,penumbra:n=.5,decay:i=1,leftPosition:r=[.75,.76,1.8],rightPosition:d=[-.75,.76,1.8],targetPosition:c=[0,0,10]}={}){const a=new Ne(e,o,s,t,n,i);a.position.set(...r),a.target.position.set(...c),a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.camera.near=.5,a.shadow.camera.far=20,a.shadow.camera.fov=30;const g=new Ne(e,o,s,t,n,i);return g.position.set(...d),g.target.position.set(...c),g.castShadow=!0,g.shadow.mapSize.width=1024,g.shadow.mapSize.height=1024,g.shadow.camera.near=.5,g.shadow.camera.far=20,g.shadow.camera.fov=30,{left:a,right:g}}function Le(e,o,s,{store:t=null,storeKey:n=null,loop:i=!1,refDistance:r=20,volume:d=null,offset:c=0,onEnded:a=null}={}){const g=y=>{try{o.stop(),o.setBuffer(y),o.setRefDistance(r),o.setLoop(i),typeof d=="number"&&o.setVolume&&o.setVolume(d),a&&(o.onEnded=a),o.play()}catch(f){console.error("Failed to play positional audio:",f)}};if(t&&n&&t[n]){g(t[n]);return}ye(e,s).then(y=>{t&&n&&(t[n]=y),g(y)}).catch(y=>{console.error("Failed to load and play audio:",s,y)})}function Se({screenAnchor:e=new ue(-.9,.9),targetLocalPos:o=new x(0,0,0),targetObject:s=null,label:t="btn",color:n=65280}={}){const i=[new x,new x],r=new Ue().setFromPoints(i),d=new dt({color:n}),c=new ut(r,d);c.set;let a=null;typeof document<"u"&&(a=document.createElement("button"),a.color=n,a.dimmed=!1,a.className="three-linebutton",a.style.position="absolute",a.style.padding="4px 12px",a.style.border="none",a.style.borderRadius="12px",a.style.backgroundColor=ie(n),a.style.color="#272727ff",a.style.fontFamily="sans-serif",a.style.fontSize="14px",a.style.cursor="pointer",a.style.transform="translate(-50%, -50%)",a.style.boxShadow="0 2px 2px rgba(255, 255, 255, 0.24)",a.style.userSelect="none",a.textContent=t,document.body.appendChild(a),a.addEventListener("mouseenter",()=>{a.style.backgroundColor=ie(Math.min(n*4,16777215))}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor=a.dimmed?"#444444":ie(n)}));const g=new ft;let y=!0;const f=new x,p=new x,m=new x,u=new x,E=new x,b=new x,A=new x;let F=null,R=null,De=0;function ot(O){if((De%30===0||!F)&&(F=document.querySelector("canvas.webgl"),F&&(R=F.getBoundingClientRect())),De++,f.set(e.x,e.y,.5),f.unproject(O),p.copy(f).sub(O.position).normalize(),m.copy(O.position).add(p.multiplyScalar(1)),s?(u.copy(o),s.localToWorld(u)):u.copy(o),E.copy(u).sub(O.position).normalize(),g.set(O.position,E),b.copy(u),s){const J=g.intersectObject(s,!0);J&&J.length>0&&b.copy(J[0].point)}const we=c.geometry.attributes.position;if(we.setXYZ(0,m.x,m.y,m.z),we.setXYZ(1,b.x,b.y,b.z),we.needsUpdate=!0,a&&R)if(A.copy(m).project(O),!y||A.z>1||A.z<-1||A.x<-1.2||A.x>1.2||A.y<-1.2||A.y>1.2)a.style.display="none";else{a.style.display="";const J=(A.x*.5+.5)*R.width+R.left,st=(-A.y*.5+.5)*R.height+R.top;a.style.left=`${J}px`,a.style.top=`${st}px`}}function nt(O){y=O,c.visible=O,a&&(a.style.display=O?"":"none")}function it(){a&&a.parentElement&&(a.removeEventListener("mouseenter",null),a.removeEventListener("mouseleave",null),a.parentElement.removeChild(a),a=null),c.geometry&&c.geometry.dispose(),c.material&&c.material.dispose()}return{line:c,button:a,update:ot,setVisible:nt,dispose:it}}const be=1e3,z=new Ue,pe=new Float32Array(be*3),te=new Float32Array(be*4),Qe=new Float32Array(be);z.setAttribute("position",new He(pe,3));z.setAttribute("color",new He(te,4));z.setAttribute("size",new He(Qe,1));const Te=new pt({size:.1,vertexColors:!0,transparent:!0,opacity:.5,blending:gt}),Ut=new ht(z,Te),P={pool:[],active:[],acquire(){let e;return this.pool.length>0?e=this.pool.pop():e={offset:[0,0,0],scale:[0,0],quaternion:[0,0,0,0],rotation:0,color:[1,1,1,1],blend:0,texture:0,live:0,scaleIncrease:0,opacityDecrease:0,colorFrom:[0,0,0],colorTo:[0,0,0],colorSpeed:0,colorProgress:0},this.active.push(e),e},release(e){const o=this.active.indexOf(e);o>-1&&(this.active.splice(o,1),this.pool.push(e))},getActiveCount(){return this.active.length},clear(){for(;this.active.length>0;)this.pool.push(this.active.pop())}},D={emitters:[],enabled:!0,visible:!0,initialize:()=>{const e={enabled:!1,position:new x(-.5,.3,-2),settings:{radius1:.02,radius2:.1,radiusHeight:.2,addTime:.02,elapsed:0,liveTimeFrom:1,liveTimeTo:1.5,opacityDecrease:.008,rotationFrom:.5,rotationTo:1,speedFrom:.003,speedTo:.006,scaleFrom:.1,scaleIncrease:.002,colorFrom:[.9,.9,.9],colorTo:[.5,.5,.5],colorSpeedFrom:1,colorSpeedTo:1,brightnessFrom:.5,brightnessTo:.9,opacity:.6,blend:.8,texture:.5}};D.emitters.push(e)},update:(e,o)=>{D.emitters.forEach(t=>{if(o!=="stop"?(t.enabled=!0,t.settings.addTime=o==="accel"?.01:.02,t.settings.speedFrom=o==="accel"?.005:.003,t.settings.speedTo=o==="accel"?.008:.006):t.enabled=!1,t.enabled){let n=0;for(t.settings.elapsed+=e,n=Math.floor(t.settings.elapsed/t.settings.addTime),t.settings.elapsed-=n*t.settings.addTime;n--&&!(P.getActiveCount()>=be);){const i=P.acquire(),r=t.settings.radius1*Math.sqrt(Math.random()),d=2*Math.PI*Math.random(),c=t.position.x+r*Math.cos(d),a=t.position.z+r*Math.sin(d),g=t.settings.radius2*Math.sqrt(Math.random()),y=c+g*Math.cos(d),f=a+g*Math.sin(d),p=new x(y-c,t.settings.radiusHeight,f-a).normalize(),m=Math.random()*(t.settings.speedTo-t.settings.speedFrom)+t.settings.speedFrom;p.multiplyScalar(m);const u=Math.random()*(t.settings.brightnessTo-t.settings.brightnessFrom)+t.settings.brightnessFrom;i.offset[0]=c,i.offset[1]=t.position.y,i.offset[2]=a,i.scale[0]=t.settings.scaleFrom,i.scale[1]=t.settings.scaleFrom,i.quaternion[0]=p.x,i.quaternion[1]=p.y,i.quaternion[2]=p.z,i.quaternion[3]=3,i.rotation=Math.random()*(t.settings.rotationTo-t.settings.rotationFrom)+t.settings.rotationFrom,i.color[0]=1,i.color[1]=1,i.color[2]=1,i.color[3]=t.settings.opacity,i.blend=t.settings.blend,i.texture=t.settings.texture,i.live=Math.random()*(t.settings.liveTimeTo-t.settings.liveTimeFrom)+t.settings.liveTimeFrom,i.scaleIncrease=t.settings.scaleIncrease,i.opacityDecrease=t.settings.opacityDecrease,i.colorFrom[0]=t.settings.colorFrom[0]*u,i.colorFrom[1]=t.settings.colorFrom[1]*u,i.colorFrom[2]=t.settings.colorFrom[2]*u,i.colorTo[0]=t.settings.colorTo[0]*u,i.colorTo[1]=t.settings.colorTo[1]*u,i.colorTo[2]=t.settings.colorTo[2]*u,i.colorSpeed=Math.random()*(t.settings.colorSpeedTo-t.settings.colorSpeedFrom)+t.settings.colorSpeedFrom,i.colorProgress=0}}});const s=P.active;for(let t=s.length-1;t>=0;t--){const n=s[t];if(n.offset[0]+=n.quaternion[0],n.offset[1]+=n.quaternion[1],n.offset[2]+=n.quaternion[2],n.scale[0]+=n.scaleIncrease,n.scale[1]+=n.scaleIncrease,n.colorProgress+=n.colorSpeed,n.colorProgress>1&&(n.colorProgress=1),n.color[0]=n.colorFrom[0]+(n.colorTo[0]-n.colorFrom[0])*n.colorProgress,n.color[1]=n.colorFrom[1]+(n.colorTo[1]-n.colorFrom[1])*n.colorProgress,n.color[2]=n.colorFrom[2]+(n.colorTo[2]-n.colorFrom[2])*n.colorProgress,n.color[3]-=n.opacityDecrease,n.live-=e,n.live<=0||n.color[3]<=0){P.release(n);continue}const i=t*3;pe[i]=n.offset[0],pe[i+1]=n.offset[1],pe[i+2]=n.offset[2];const r=t*4;te[r]=n.color[0],te[r+1]=n.color[1],te[r+2]=n.color[2],te[r+3]=n.color[3],Qe[t]=n.scale[0]}P.getActiveCount()>0&&(z.attributes.position.needsUpdate=!0,z.attributes.color.needsUpdate=!0,z.attributes.size.needsUpdate=!0)},getMesh:()=>Ut,dispose:()=>{P.clear(),z&&z.dispose(),Te&&Te.dispose(),D.emitters.length=0},getStats:()=>({activeParticles:P.getActiveCount(),pooledParticles:P.pool.length,totalAllocated:P.active.length+P.pool.length})};function Xt({emitters:e={},initialVisible:o=!1}={}){let s=o,t=null;const n=new Map;function i(){return t||(t=document.createElement("div"),t.id="audio-volume-panel",Object.assign(t.style,{position:"fixed",bottom:"10px",right:"10px",padding:"8px",background:"rgba(0,0,0,0.6)",color:"#fff",borderRadius:"6px",zIndex:9999,fontFamily:"monospace",fontSize:"12px",pointerEvents:"none",display:s?"":"none"}),document.body.appendChild(t),t)}function r(f){const p=document.createElement("div");p.dataset.pos=f,Object.assign(p.style,{display:"flex",alignItems:"center",marginBottom:"6px",pointerEvents:"auto",flexDirection:"row"});const m=document.createElement("div");m.className="vol-label",m.textContent=f,Object.assign(m.style,{width:"70px",textTransform:"capitalize"});const u=document.createElement("div");u.className="vol-bar-container",Object.assign(u.style,{width:"64px",height:"12px",background:"rgba(255,255,255,0.08)",borderRadius:"3px",display:"flex",alignItems:"center",overflow:"hidden",marginLeft:"8px",marginRight:"8px"});const E=document.createElement("div");E.className="vol-bar",Object.assign(E.style,{width:"0%",height:"100%",background:"#666",transition:"width 0.08s linear"});const b=f.toUpperCase();return G[b]!==void 0&&(E.style.background=ie(G[b])),u.appendChild(E),p.appendChild(m),p.appendChild(u),p}function d(f,p){if(!n.has(f)&&p?.getOutput()){const m=new mt(p,32);n.set(f,m)}return n.get(f)}function c(f,p){const m=d(f,p);if(!m)return 0;const u=m.getAverageFrequency()/255,E=p&&p.getVolume?p.getVolume():0;return u*E}function a(){const f=i();Object.entries(e).forEach(([p,m])=>{if(p==="mix")return;let u=f.querySelector(`[data-pos="${p}"]`);u||(u=r(p),f.appendChild(u));const E=c(p,m)*3,b=u.querySelector(".vol-bar");b.style.width=`${Math.max(0,Math.min(1,E))*100}%`}),t.style.display=s?"":"none"}function g(f){s=!!f,t&&(t.style.display=s?"":"none")}function y(){n.forEach(f=>{if(f&&f.analyser)try{f.analyser.disconnect()}catch(p){console.warn("Error disposing analyser:",p)}}),n.clear(),t&&t.parentElement&&(t.parentElement.removeChild(t),t=null)}return{update:a,setVisible:g,isVisible:()=>s,dispose:y}}function Kt({initVisible:e=!1,initIgnition:o=!1,initHeadlights:s=!0}={}){let t=null,n=e,i=o,r=null,d=s,c=null;function a(u){r=u}function g(u){c=u}function y(){if(t)return t;t=document.createElement("div"),t.id="controls-panel",Object.assign(t.style,{position:"fixed",top:"10px",left:"10px",padding:"8px",background:"rgba(0,0,0,0.0)",color:"#fff",borderRadius:"6px",zIndex:9999,fontFamily:"monospace",fontSize:"12px",pointerEvents:"none",display:n?"":"none",border:"none"});const u=document.createElement("button");u.className="ignition-toggle",u.innerHTML=`
            <span class="ignition-start" style="font-weight:bold;color:#fff;">START</span>
            <span class="ignition-stop" style="color:#aaa;">STOP</span>
        `,Object.assign(u.style,{display:"block",margin:"4px 0",padding:"0",width:"75px",height:"75px",borderRadius:"50%",background:"radial-gradient(circle at 60% 40%, #a00 80%, #cc2f2f 100%)",border:"2px solid #fff",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",cursor:"pointer",color:"#fff",fontFamily:"inherit",fontSize:"16px",textAlign:"center",lineHeight:"16px",position:"relative",transition:"background 0.2s"});function E(){const F=u.querySelector(".ignition-start"),R=u.querySelector(".ignition-stop");i?(F.style.fontWeight="normal",F.style.color="#888",R.style.fontWeight="bold",R.style.color="#fff",u.style.background="radial-gradient(circle at 60% 40%, #cc2f2f 80%, #a00 100%)"):(F.style.fontWeight="bold",F.style.color="#fff",R.style.fontWeight="normal",R.style.color="#888",u.style.background="radial-gradient(circle at 60% 40%, #a00 80%, #cc2f2f 100%)"),r&&r(i)}u.addEventListener("click",()=>{i=!i,E()}),t.style.pointerEvents="auto",t.appendChild(u);const b=document.createElement("button");b.className="headlights-toggle",b.innerHTML=`
            <span style="
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            position: absolute;
            left: 0; top: 0;
            ">
            <svg width="36" height="36" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <!-- Bulb -->
            <path d="M18 36 A6 6 0 0 1 18 12" fill="none" stroke="#fff" stroke-width="2.2"/>
            <line x1="18" y1="12" x2="18" y2="36" stroke="#fff" stroke-width="2.2"/>
            <!-- Beams, angled downwards -->
            <path class="headlight-beams" d="
            M26 19 L40 23
            M26 24 L40 28
            M26 29 L40 33
            " stroke="#ff0" stroke-width="3" stroke-linecap="round" opacity="1"/>
            </svg>
            </span>
        `,Object.assign(b.style,{display:"block",margin:"12px auto 0 auto",padding:"0",width:"56px",height:"28px",borderRadius:"10px",background:"radial-gradient(circle at 60% 40%, #181818 80%, #222 100%)",border:"2px solid #fff",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",cursor:"pointer",color:"#fff",fontFamily:"inherit",fontSize:"14px",textAlign:"center",lineHeight:"14px",position:"relative",transition:"background 0.2s",overflow:"hidden"});function A(){const F=b.querySelector(".headlight-beams");d?(F.setAttribute("stroke","#ff0"),F.style.opacity="1",b.style.background="radial-gradient(circle at 60% 40%, #222 80%, #333 100%)"):(F.setAttribute("stroke","#888"),F.style.opacity="0.5",b.style.background="radial-gradient(circle at 60% 40%, #181818 80%, #222 100%)"),c&&c(d)}return A(),b.addEventListener("click",()=>{d=!d,A()}),t.appendChild(b),document.body.appendChild(t),t}function f(){y(),t.style.display=n?"":"none"}function p(u){n=!!u,t&&(t.style.display=n?"":"none")}function m(){t&&t.parentElement&&(t.parentElement.removeChild(t),t=null)}return{registerIgnitionCallback:a,registerHeadlightsCallback:g,update:f,setVisible:p,isVisible:()=>n,dispose:m}}function Qt({initialVisible:e=!1}={}){let o=e,s=null,t=0,n=performance.now(),i=0,r=0;function d(){return s||(s=document.createElement("div"),s.id="performance-stats",Object.assign(s.style,{position:"fixed",bottom:"10px",left:"10px",padding:"8px",background:"rgba(0,0,0,0.6)",color:"#fff",borderRadius:"6px",zIndex:9999,fontFamily:"monospace",fontSize:"12px",pointerEvents:"none",display:o?"":"none",minWidth:"120px"}),document.body.appendChild(s),s)}function c(){t++;const y=performance.now(),f=y-n;if(f>=1e3&&(i=Math.round(t*1e3/f),r=f/t,t=0,n=y),o){const p=d();let m="#00ff00";i<60&&(m="#ffff00"),i<30&&(m="#ff0000"),p.innerHTML=`
                <div style="margin-bottom: 4px;">
                    <span style="color: #888;">FPS:</span> 
                    <span style="color: ${m}; font-weight: bold;">${i}</span>
                </div>
                <div>
                    <span style="color: #888;">Frame:</span> 
                    <span>${r.toFixed(2)}ms</span>
                </div>
            `}}function a(y){o=!!y,s&&(s.style.display=o?"":"none")}function g(){s&&s.parentElement&&(s.parentElement.removeChild(s),s=null)}return{update:c,setVisible:a,isVisible:()=>o,dispose:g,getStats:()=>({fps:i,frameTime:r})}}yt.enabled=!1;var Q=$.STOP,ge=ne.MIX;const Fe=Dt();if(!Fe.available)throw X("WebGL Not Supported",Fe.error,!0),new Error(Fe.error);const Ae=Vt();if(!Ae.available)throw X("Web Audio Not Supported",Ae.error,!0),new Error(Ae.error);const _={modelsLoaded:!1,audioLoaded:!1,sceneReady:!1},Ye=document.querySelector("canvas.webgl"),h=new bt;h.background=new Xe(10526880);h.fog=new xt(15716789,.05);const ae=new wt,se={Meters:!0,Emitters:!1},xe=ae.addFolder("Audio");let oe=null;const Ze=ae.addFolder("Vehicle"),Yt=ae.addFolder("Performance"),Zt={"Show Stats":!1},Re=new vt,ce=new We,Jt=new Ct;new Et;const K=new de(new Lt(10,10),new St({color:"#444444",metalness:0,roughness:.5}));K.receiveShadow=!0;K.rotation.x=-Math.PI*.5;h.add(K);const ke=h.background?h.background.clone():new Xe(10526880);let W=null;const eo=["None",...Object.keys(Ke)],to={HDR:"None"};Ze.add(to,"HDR",eo).name("Level Select").onChange(e=>{if(e==="None"){W&&(Me(W),W=null),h.background=ke.clone?ke.clone():ke,h.environment=null,K.visible=!0,_e(null),h.fog&&(h.fog.color.set(15716789),h.fog.density=.05),typeof w.toneMappingExposure=="number"&&(w.toneMappingExposure=L.exposure),h.traverse(n=>{n.isMesh&&n.material&&(Array.isArray(n.material)?n.material.forEach(i=>i.needsUpdate=!0):n.material.needsUpdate=!0)}),console.log("[HDR Reset] Ambient",T.intensity,T.color.getHexString()),Z.forEach((n,i)=>console.log(`[HDR Reset] Dir${i}`,n.intensity,n.color.getHexString())),console.log("[HDR Reset] Hemi",C.intensity,C.color.getHexString(),C.groundColor.getHexString()),S.removeConvolutionReverb(),he.Reverb="None",oe&&oe.updateDisplay();return}const o=Ke[e];if(!o)return;const s=typeof o=="string"?o:o.path,t=typeof o=="object"?o.reverb:null;$t(Jt,s).then(n=>{if(W&&Me(W),n.mapping=kt,W=n,h.background=n,h.environment=n,K.visible=!1,o.lighting&&_e(o.lighting),t&&he&&(he.Reverb=t,oe)){oe.updateDisplay();const i=Pe[t];if(i){const{path:r,blend:d=.5,scalingFactor:c=1}=i;S.currentReverbBlend=d,S.currentReverbScalingFactor=c,ye(new We,r).then(a=>{S.applyConvolutionReverb(a)}).catch(a=>{console.error("Failed to load reverb:",a),X("Reverb Load Failed",`Could not load reverb: ${a.message}`,!1)})}}}).catch(n=>{console.error("Failed to load HDR:",n),X("HDR Load Failed",`Could not load environment: ${n.message}`,!1)})});let v=new Be;h.add(v);v.add(D.getMesh());const j=[];let l={mixerWheels:null,actWheelsRot:null,actTiresRot:null,mixerLights:null,actLights0:null,actLights1:null,actLights2:null,actLights3:null,actLights4:null,headLightL:null,headLightR:null,lightsFlipFlop:!0,lightsIntensity:3,lightsTimeScaleToggle:()=>{if(l.mixerLights)if(l.lightsFlipFlop){l.mixerLights.timeScale=1.5;for(let e=0;e<5;e++){const o=`actLights${e}`;l[o]&&(l[o].time=0)}l.lightsFlipFlop=!1}else{l.mixerLights.timeScale=-1.5;for(let e=0;e<5;e++){const o=`actLights${e}`;l[o]&&(l[o].time=l[o].getClip().duration-l[o].time)}l.lightsFlipFlop=!0}},lights:()=>{l.mixerLights&&(l.mixerLights.stopAllAction(),l.lightsTimeScaleToggle(),l.actLights0&&l.actLights0.play(),l.actLights1&&l.actLights1.play(),l.actLights2&&l.actLights2.play(),l.actLights3&&l.actLights3.play(),l.actLights4&&l.actLights4.play())}};async function oo(){const e=Nt("Loading models...");try{e.update("Loading car model...");const[o,s,t]=await Promise.all([Ee(Re,"./model/rx7/rx7.gltf"),Ee(Re,"./model/rx7_wheels/rx7_wheels.gltf"),Ee(Re,"./model/rx7_lights/rx7_lights.gltf")]);e.update("Setting up scene..."),o.scene.scale.set(1,1,1),v.add(o.scene),D.initialize(),s.scene.scale.set(1,1,1),s.scene.position.set(0,0,0),v.add(s.scene);const n=s.scene.clone();n.position.set(0,0,2.45),v.add(n);const i=s.scene.clone();i.position.set(0,0,2.45),i.scale.set(-1,1,1),v.add(i);const r=s.scene.clone();r.position.set(0,0,0),r.scale.set(-1,1,1),v.add(r),l.mixerWheels=new $e(new Ht(s.scene,n,i,r)),l.actWheelsRot=l.mixerWheels.clipAction(s.animations[0]),l.actTiresRot=l.mixerWheels.clipAction(s.animations[1]),t.scene.scale.set(1,1,1),v.add(t.scene),l.mixerLights=new $e(t.scene);for(let a=0;a<5;a++){const g=`actLights${a}`;l[g]=l.mixerLights.clipAction(t.animations[a]),l[g].setLoop(Wt),l[g].clampWhenFinished=!0}const{left:d,right:c}=Bt({intensity:l.lightsIntensity});l.headLightL=d,l.headLightR=c,v.add(l.headLightL),v.add(l.headLightL.target),v.add(l.headLightR),v.add(l.headLightR.target),no(o.scene),_.modelsLoaded=!0,e.remove(),console.log("✓ All models loaded successfully")}catch(o){e.remove(),console.error("Failed to load models:",o),X("Failed to Load Models",`Could not load required 3D models. Please check your connection and refresh the page.

Error: ${o.message}`,!1)}}function no(e){const o=Se({screenAnchor:new ue(-.5,-.8),targetLocalPos:new x(0,.2,2.1),targetObject:e,label:"Intake",color:G.INTAKE}),s=Se({screenAnchor:new ue(.5,-.8),targetLocalPos:new x(-.5,.3,-2),targetObject:e,label:"Exhaust",color:G.EXHAUST}),t=Se({screenAnchor:new ue(0,-.8),targetLocalPos:new x(0,.1,-.2),targetObject:e,label:"Interior",color:G.INTERIOR});[o,s,t].forEach(i=>{h.add(i.line),j.push(i),i.button.addEventListener("click",()=>{ne[i.button.textContent.toUpperCase()]===ge?(ge=ne.MIX,j.forEach(r=>{r!==i&&(r.button.style.backgroundColor=ie(G[r.button.textContent.toUpperCase()]),r.button.style.color="#272727ff",r.line.visible=!0,r.button.dimmed=!1)}),se.Emitters&&U.forEach(r=>r.visible=!0)):(ge=ne[i.button.textContent.toUpperCase()],j.forEach(r=>{if(r!==i){if(r.button.style.backgroundColor="#444444",r.button.style.color="#888888",r.line.visible=!1,r.button.dimmed=!0,se.Emitters){const d=r.button.textContent.toLowerCase(),c=U.get(d);c&&(c.visible=!1)}}else if(r.button.style.color="#272727ff",r.line.visible=!0,r.button.dimmed=!1,se.Emitters){const d=r.button.textContent.toLowerCase(),c=U.get(d);c&&(c.visible=!0)}}))})});const n={"Solo Buttons":!0};xe.add(n,"Solo Buttons").onChange(i=>{o.setVisible(i),s.setVisible(i),t.setVisible(i)})}oo().then(()=>{Oe()}).catch(e=>{console.error("Critical error during model initialization:",e)});function Oe(){_.modelsLoaded&&_.audioLoaded&&!_.sceneReady&&(_.sceneReady=!0,console.log("✓ Scene fully initialized and ready"))}const C=new Rt(k.hemisphere.skyColor,k.hemisphere.groundColor,k.hemisphere.intensity);C.position.set(0,100,0);h.add(C);const T=new At(k.ambient.color,k.ambient.intensity);h.add(T);const Z=qt([{color:k.directional[0].color,intensity:k.directional[0].intensity,position:[5,3,4]},{color:k.directional[1].color,intensity:k.directional[1].intensity,position:[8,3,-1]},{color:k.directional[2].color,intensity:k.directional[2].intensity,position:[-5,5,-5]}]);Z.forEach(e=>h.add(e));let L=null;function Je(){L={ambient:{color:T.color.getHex(),intensity:T.intensity},hemi:{sky:C.color.getHex(),ground:C.groundColor.getHex(),intensity:C.intensity},directional:Z.map(e=>({color:e.color.getHex(),intensity:e.intensity})),fog:h.fog?{color:h.fog.color.getHex(),density:h.fog.density}:null,exposure:typeof w<"u"&&typeof w.toneMappingExposure=="number"?w.toneMappingExposure:1}}function et(){L||Je(),T.color.setHex(L.ambient.color),T.intensity=L.ambient.intensity,C.color.setHex(L.hemi.sky),C.groundColor.setHex(L.hemi.ground),C.intensity=L.hemi.intensity,Z.forEach((e,o)=>{e.color.setHex(L.directional[o].color),e.intensity=L.directional[o].intensity}),h.fog&&L.fog&&(h.fog.color.setHex(L.fog.color),h.fog.density=L.fog.density),L&&typeof w<"u"&&typeof w.toneMappingExposure=="number"&&(w.toneMappingExposure=L.exposure)}function _e(e){if(!e){et();return}e.ambient&&(e.ambient.color!==void 0&&T.color.setHex(e.ambient.color),e.ambient.intensity!==void 0&&(T.intensity=e.ambient.intensity)),e.hemisphere&&(e.hemisphere.skyColor!==void 0&&C.color.setHex(e.hemisphere.skyColor),e.hemisphere.groundColor!==void 0&&C.groundColor.setHex(e.hemisphere.groundColor),e.hemisphere.intensity!==void 0&&(C.intensity=e.hemisphere.intensity)),e.directional&&Array.isArray(e.directional)&&Z.forEach((o,s)=>{const t=e.directional[s];t&&(t.color!==void 0&&o.color.setHex(t.color),t.intensity!==void 0&&(o.intensity=t.intensity))})}const I={width:window.innerWidth,height:window.innerHeight},io=()=>{I.width=window.innerWidth,I.height=window.innerHeight,N.aspect=I.width/I.height,N.updateProjectionMatrix(),w.setSize(I.width,I.height),w.setPixelRatio(Math.min(window.devicePixelRatio,2))};window.addEventListener("resize",io);const N=new Mt(75,I.width/I.height,.1,100);N.position.set(4,2,3);h.add(N);const ze=new Tt(N,Ye);ze.target.set(0,.75,0);ze.enableDamping=!0;const w=new Ft({canvas:Ye});w.outputColorSpace=Ot;w.shadowMap.enabled=!0;w.shadowMap.type=Pt;w.setSize(I.width,I.height);w.setPixelRatio(Math.min(window.devicePixelRatio,2));Je();et();const q=new It;N.add(q);const Y=q.context,M={mix:new le(q),intake:new le(q),exhaust:new le(q),interior:new le(q)};console.log("Audio Emitters:",M);Object.entries(M).forEach(([e,o])=>{switch(v.add(o),e){case"intake":o.position.set(0,.2,2.1),o.setVolume(0),o.setDirectionalCone(ee.degToRad(H.innerAngle),ee.degToRad(H.outerAngle),H.outerGain);break;case"exhaust":o.position.set(-.5,.3,-2),o.setVolume(0),o.rotation.y=Math.PI,o.setDirectionalCone(ee.degToRad(H.innerAngle),ee.degToRad(H.outerAngle),H.outerGain);break;case"interior":o.position.set(0,.5,-.2),o.setVolume(0);break;case"mix":o.position.set(0,0,0),o.setVolume(1);break;default:o.position.set(0,0,0);break}});const S={buffers:{mix:{},intake:{ignitionOn:null,idle:null,ignitionOff:null},exhaust:{ignitionOn:null,idle:null,ignitionOff:null},interior:{ignitionOn:null,idle:null,ignitionOff:null}},currentEmitter:null,setEmitterVolumes(e){["intake","exhaust","interior"].forEach(s=>{const t=M[s];if(!t)return;const n=e===ne.MIX?Ce.MIX:s===e?1:0,i=Ce[s.toUpperCase()]!==void 0?Ce[s.toUpperCase()]:1,r=Math.max(0,Math.min(1,n*i)),d=t.getVolume();d<r?t.setVolume(Math.min(r,d+.2)):d>r&&t.setVolume(Math.max(r,d-.2))}),M.mix.setVolume(0)},ignitionOn:()=>{Y.state==="suspended"&&Y.resume().then(()=>{console.log("Audio context enabled via user interaction")}).catch(e=>{console.error("Failed to resume audio context:",e)}),Object.entries(M).forEach(([e,o])=>{e!=="mix"&&Le(ce,o,`./audio/${e}/ignitionOn.ogg`,{store:S.buffers[e],storeKey:"ignitionOn",loop:!1,onEnded:()=>{Le(ce,o,`./audio/${e}/idle.ogg`,{store:S.buffers[e],storeKey:"idle",loop:!0,onEnded:()=>{}})}})}),Q=$.ACCEL,l.mixerWheels&&(l.mixerWheels.stopAllAction(),l.actWheelsRot.play(),l.actTiresRot.play(),l.mixerWheels.timeScale=.01)},ignitionOff:()=>{Object.entries(M).forEach(([e,o])=>{e!=="mix"&&Le(ce,o,`./audio/${e}/ignitionOff.ogg`,{store:S.buffers[e],storeKey:"ignitionOff",loop:!1,onEnded:()=>{o.stop()}})}),Q=$.DECEL},load(){const e=this,o=[];Object.keys(e.buffers).forEach(s=>{Object.keys(e.buffers[s]).forEach(t=>{const n=ye(ce,`./audio/${s}/${t}.ogg`).then(i=>{e.buffers[s][t]=i}).catch(i=>{console.error(`Failed to load audio ${s}/${t}:`,i)});o.push(n)})}),Promise.all(o).then(()=>{_.audioLoaded=!0,console.log("✓ All audio files loaded"),Oe()}).catch(()=>{_.audioLoaded=!0,X("Audio Load Warning","Some audio files failed to load. The experience may be incomplete.",!1),Oe()})},applyConvolutionReverb(e){const o=this.currentReverbBlend??.5;Object.values(M).forEach(s=>{if(s._reverbNodes){try{const{dryGain:c,wetGain:a,convolver:g}=s._reverbNodes;c.disconnect(),a.disconnect(),g.disconnect()}catch{}s._reverbNodes=null}const t=q.context,n=t.createConvolver();n.buffer=e;const i=t.createGain(),r=t.createGain();i.gain.value=o*this.currentReverbScalingFactor,r.gain.value=(1-o)*this.currentReverbScalingFactor;const d=s.panner;if(!d){console.warn("PositionalAudio panner node missing; cannot apply reverb graph");return}d.connect(r),r.connect(t.destination),d.connect(n),n.connect(i),i.connect(t.destination),s._reverbNodes={convolver:n,wetGain:i,dryGain:r}})},removeConvolutionReverb(){Object.values(M).forEach(e=>{if(e._reverbNodes){try{const{dryGain:o,wetGain:s,convolver:t}=e._reverbNodes;o.disconnect(),s.disconnect(),t.disconnect()}catch(o){console.warn("Error disconnecting reverb nodes:",o)}e._reverbNodes=null}}),this.currentReverbBlend=null,this.currentReverbScalingFactor=null}};S.load();const Pe={Garage:{path:"./audio/ir/garage.ogg",blend:.8,scalingFactor:.33},Outdoors:{path:"./audio/ir/outdoors.ogg",blend:.6,scalingFactor:.2}},he={Reverb:"None"};oe=xe.add(he,"Reverb",["None",...Object.keys(Pe)]).name("Conv. Reverb").onChange(e=>{if(e==="None"){S.removeConvolutionReverb();return}const o=Pe[e];if(!o)return;const{path:s,blend:t=.5,scalingFactor:n=1}=o;S.currentReverbBlend=t,S.currentReverbScalingFactor=n,ye(new We,s).then(i=>{S.applyConvolutionReverb(i)}).catch(i=>{console.error("Failed to load reverb:",i),X("Reverb Load Failed",`Could not load reverb preset: ${i.message}`,!1)})});const V=Kt({initVisible:!0,initIgnition:!1,initHeadlights:!0});V.registerIgnitionCallback(e=>{console.log("Ignition:",e?"ON":"OFF"),e?S.ignitionOn():S.ignitionOff()});V.registerHeadlightsCallback(e=>{console.log("Headlights:",e?"ON":"OFF"),l.lights()});console.log("Controls panel created",V);const B=Xt({emitters:M,initialVisible:!0});xe.add(se,"Meters").onChange(e=>B.setVisible(e));const re=Qt({initialVisible:!1});Yt.add(Zt,"Show Stats").onChange(e=>re.setVisible(e));const U=new Map;Object.entries(M).forEach(([e,o])=>{if(e==="mix")return;const s={color:G[e.toUpperCase()]||16776960,size:.4};e==="intake"?(s.showCone=!0,s.coneAngle=H.innerAngle,s.coneDirection=new x(0,0,1)):e==="exhaust"&&(s.showCone=!0,s.coneAngle=H.innerAngle,s.coneDirection=new x(0,0,-1));const t=jt(o,s);t.visible=!1,v.add(t),U.set(e,t)});xe.add(se,"Emitters").onChange(e=>{U.forEach(o=>o.visible=e)});const qe=["Mazda RX-7 FD"];Ze.add({car:qe[0]},"car",qe).name("Car").onChange(e=>{});function so(){console.log("Cleaning up resources..."),me&&(cancelAnimationFrame(me),me=null),j.forEach(e=>{e&&e.dispose&&e.dispose()}),j.length=0,U.forEach(e=>{fe(e)}),U.clear(),V&&V.dispose&&V.dispose(),B&&B.dispose&&B.dispose(),re&&re.dispose&&re.dispose(),Object.values(M).forEach(e=>{Gt(e)}),D&&D.dispose&&D.dispose(),W&&(Me(W),W=null),v&&fe(v),K&&fe(K),l.mixerWheels&&(l.mixerWheels.stopAllAction(),l.mixerWheels=null),l.mixerLights&&(l.mixerLights.stopAllAction(),l.mixerLights=null),C&&h.remove(C),T&&h.remove(T),Z.forEach(e=>{h.remove(e),e.dispose()}),w&&w.dispose(),ae&&ae.destroy(),console.log("Cleanup complete")}let me=null,Ie=!document.hidden;document.addEventListener("visibilitychange",()=>{Ie=!document.hidden,Ie?(console.log("Tab visible - resuming simulation"),Y&&Y.state==="suspended"&&Y.resume().catch(e=>{console.warn("Failed to resume audio context:",e)})):(console.log("Tab hidden - pausing heavy computations"),Y.suspend())});window.addEventListener("beforeunload",()=>{so()});const ro=new zt;let je=0;const tt=()=>{const e=ro.getElapsedTime(),o=e-je;if(je=e,Ie){if(l.mixerWheels)switch(l.mixerWheels.update(o),Q){case $.ACCEL:for(;l.mixerWheels.timeScale<1;)l.mixerWheels.timeScale+=o,l.mixerWheels.timeScale>=1&&(l.mixerWheels.timeScale=1,Q=$.DRIVE);break;case $.DECEL:for(;l.mixerWheels.timeScale>0;)l.mixerWheels.timeScale-=o,l.mixerWheels.timeScale<=0&&(l.mixerWheels.timeScale=0,Q=$.STOP,l.mixerWheels.stopAllAction());break}if(l.mixerLights&&(l.mixerLights.update(o),l.actLights0&&l.headLightL&&l.headLightR)){const s=l.lightsIntensity-l.actLights0.time/l.actLights0.getClip().duration*l.lightsIntensity;l.headLightL.intensity=l.headLightR.intensity=s}v.position.z=Math.sin(e*2)*.0125,D.update(o,Q),j.length>0&&j.forEach(s=>{try{s.update(N)}catch{}}),S.setEmitterVolumes(ge),V&&V.update&&V.update(),B&&B.update&&B.update()}ze.update(),re.update(),w.render(h,N),me=window.requestAnimationFrame(tt)};tt();
//# sourceMappingURL=index-DArvlJgK.js.map
